#!/usr/bin/env ruby

#------------------------------------------------------------
# $Id$
#
# run any or all test suites

$:.unshift '.'
$:.unshift '../lib'

# if we're not in the library trunk, then add that to the lib search path
#if Dir.getwd !~ %r{puppet/library}
#    $:.unshift '../../../library/trunk/lib/'
#    $:.unshift '../../../language/trunk/lib/'
#    $:.unshift '../../../library/trunk/test/'
#end

require 'puppettest.rb'

require 'getoptlong'

	#[ "--size",	"-s",			GetoptLong::REQUIRED_ARGUMENT ],
result = GetoptLong.new(
	[ "--help",		"-h",			GetoptLong::NO_ARGUMENT ]
)

usage = "USAGE: %s [--help] <testsuite> <testsuite> .." % $0

result.each { |opt,arg|
	case opt
		when "--help"
			puts usage
			exit
		else
			raise "Invalid option '#{opt}'"
	end
}

$puppetbase = ".."

suites = nil

if ARGV.length != 0
    suites = ARGV
else
    suites = PuppetTestSuite.list
end

suites.each { |suite|
    PuppetTestSuite.new(suite)
}

# This damn problem just doesn't seem to want to go away
system("%s/etc/init.d/sleeper stop 2>/dev/null 1>/dev/null" % $puppetbase)
