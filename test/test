#!/usr/bin/env ruby

#------------------------------------------------------------
# run any or all test suites

basedir = File.dirname(__FILE__)
$puppetbase = File.expand_path(File.join(basedir, ".."))

$:.unshift basedir
$:.unshift "#{$puppetbase}/lib"


require 'puppettest.rb'
require 'getoptlong'

	#[ "--size",	"-s",			GetoptLong::REQUIRED_ARGUMENT ],
result = GetoptLong.new(
	[ "--debug",	"-d",			GetoptLong::NO_ARGUMENT ],
	[ "-n",			                GetoptLong::REQUIRED_ARGUMENT ],
	[ "--help",		"-h",			GetoptLong::NO_ARGUMENT ]
)

usage = "USAGE: %s [--help] <testsuite> <testsuite> .." % $0

opts = []

result.each { |opt,arg|
	case opt
		when "--debug"
            Puppet::Log.level = :debug
		when "--help"
			puts usage
			exit
		else
            opts << opt << arg
			#raise "Invalid option '#{opt}'"
	end
}
suites = nil

if ARGV.length != 0
    suites = ARGV.dup
else
    suites = PuppetTestSuite.list
end

ARGV.clear

opts.each { |o| ARGV << o }

suites.each { |suite|
    PuppetTestSuite.new(suite)
}

# This damn problem just doesn't seem to want to go away
system("%s/etc/init.d/sleeper stop 2>/dev/null 1>/dev/null" % $puppetbase)

# $Id$
